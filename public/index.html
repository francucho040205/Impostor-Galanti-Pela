<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>¬øQui√©n es el impostor? - Online</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- FONDO ANIMADO CON VARIAS FOTOS REBOTANDO (con colisiones reales) -->
  <div id="nyancat-bg">
    <img src="/img/foto-fondo.jpg" id="foto-rebotando1" class="foto-rebotando" alt="Fondo animado 1" />
    <img src="/img/foto-fondo2.jpg" id="foto-rebotando2" class="foto-rebotando" alt="Fondo animado 2" />
    <img src="/img/foto-fondo3.jpg" id="foto-rebotando3" class="foto-rebotando" alt="Fondo animado 3" />
    <img src="/img/foto-fondo4.jpg" id="foto-rebotando4" class="foto-rebotando" alt="Fondo animado 4" />
    <img src="/img/foto-fondo5.jpg" id="foto-rebotando5" class="foto-rebotando" alt="Fondo animado 5" />
  </div>
  <div class="topbar">
    <span>Dev by Cancer Team</span>
    <span style="float:right;">v 1.2.2</span>
  </div>
  <div class="center-outer">
    <div class="center-inner" id="app">
      <h1 class="section-title" id="titleCreate">Crea una sala</h1>
      <div style="display:flex;flex-direction:column;align-items:center;gap:32px;">
        <form class="form-card" id="createRoomForm" autocomplete="off" style="margin-bottom:0;">
          <input id="hostNameInput" type="text" placeholder="Tu nombre" maxlength="20" required>
          <button id="createRoomFinalBtn" type="submit" style="background:#43a047; color:#fff; margin-top:16px;">
            üöÄ Crear sala
          </button>
        </form>
        <h2 class="section-subtitle" id="subtitleJoin" style="margin-bottom:0;margin-top:0;">
          O unite a una con un c√≥digo
        </h2>
        <form class="form-card" id="joinRoomForm" autocomplete="off" style="margin-bottom:0;">
          <input id="roomInput" type="text" placeholder="C√≥digo de sala" maxlength="8" required>
          <input id="nameInput" type="text" placeholder="Tu nombre" maxlength="20" required>
          <button id="joinBtn" type="submit" style="background:#1e88e5; color:#fff; margin-top:16px;">
            üóùÔ∏è Unirse
          </button>
        </form>
      </div>
      <!-- LOBBY -->
      <div id="lobbyScreen" style="display:none;">
        <div class="lobby-card">
          <div class="lobby-header">
            <div class="lobby-room-label">C√≥digo de sala</div>
            <div id="lobbyRoomCode" class="lobby-room-code"></div>
          </div>
          <div class="lobby-title">Jugadores en la sala:</div>
          <ul id="lobbyPlayers"></ul>
          <div id="hostControls" style="display:none;">
            <label for="impostorsSelect" style="margin-bottom: 4px; color:#6e7e8c;">N¬∫ de impostores:</label>
            <select id="impostorsSelect">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
            </select>
          </div>
          <div class="lobby-title" style="margin-top:16px;">Tu nombre secreto a sortear</div>
          <form id="nameSuggestForm" style="width:100%;display:flex;gap:8px;justify-content:center;">
            <input id="suggestedNameInput" type="text" placeholder="Nombre secreto" maxlength="20" required style="flex:2;">
            <button id="addNameBtn" type="submit" style="flex:1;background:#2176ff;">‚ûï Agregar</button>
          </form>
          <button id="startGameBtn" type="button" style="margin-top:20px; background:#188a61;">Iniciar partida</button>
        </div>
      </div>
      <!-- TURNO DE HABLAR -->
      <div id="talkScreen" style="display:none;">
        <div class="form-card">
          <h2 id="talkTitle"></h2>
          <p id="talkInfo"></p>
          <button id="talkDoneBtn" style="margin-top:18px;">Ya habl√©</button>
        </div>
      </div>
      <!-- VOTACI√ìN -->
      <div id="voteScreen" style="display:none;">
        <div class="form-card">
          <div id="roleBox" style="margin-bottom:20px;">
            <span id="yourRoleText" class="role-text"></span>
            <span id="secretWordBox" class="secret-word"></span>
          </div>
          <div class="lobby-title">¬øQui√©n es el impostor?</div>
          <div id="playersToVote" class="players-list"></div>
          <button id="confirmVoteBtn" style="margin-top:18px;">Confirmar voto</button>
        </div>
      </div>
      <!-- RESULTADOS -->
      <div id="resultScreen" style="display:none;">
        <div class="form-card">
          <h2 id="resultTitle"></h2>
          <div id="resultSecret" style="font-size:1.25em;color:#10d084;margin-bottom:10px;"></div>
          <p id="resultInfo"></p>
          <button id="playAgainBtn">Jugar de nuevo</button>
        </div>
      </div>
    </div>
  </div>
  <!-- CHAT EN ESQUINA (solo aparece en partida/lobby) -->
  <div id="chatBox">
    <div id="chatHeader">Chat</div>
    <div id="chatMessages"></div>
    <form id="chatForm">
      <input id="chatInput" type="text" maxlength="200" placeholder="Enviar un mensaje..." autocomplete="off">
      <button type="submit">Enviar</button>
    </form>
  </div>
  <!-- AUDIO FIN DE PARTIDA -->
  <audio id="audioFinPartida" src="/audio/fin-partida.mp3"></audio>
  <!-- Script para colisiones y rebote entre im√°genes -->
  <script>
  document.addEventListener("DOMContentLoaded", function() {
    const container = document.getElementById('nyancat-bg');
    const images = Array.from(document.querySelectorAll('.foto-rebotando'));
    const balls = images.map((img, i) => {
      // Usamos el tama√±o real de la imagen (una vez cargada) para colisi√≥n
      const w = img.naturalWidth || 180;
      const h = img.naturalHeight || 130;
      return {
        x: Math.random() * (window.innerWidth - w),
        y: Math.random() * (window.innerHeight - h),
        vx: (Math.random() * 2 + 1) * (Math.random() < 0.5 ? 1 : -1),
        vy: (Math.random() * 2 + 1) * (Math.random() < 0.5 ? 1 : -1),
        w: w,
        h: h,
        img: img
      };
    });

    function rectsCollide(a, b) {
      return (
        a.x < b.x + b.w &&
        a.x + a.w > b.x &&
        a.y < b.y + b.h &&
        a.y + a.h > b.y
      );
    }

    function resolveCollision(a, b) {
      // Rebote simple: intercambia velocidades
      const tmpVx = a.vx;
      const tmpVy = a.vy;
      a.vx = b.vx;
      a.vy = b.vy;
      b.vx = tmpVx;
      b.vy = tmpVy;
      // Mueve uno un poco para evitar que se queden pegados
      a.x += a.vx;
      a.y += a.vy;
      b.x += b.vx;
      b.y += b.vy;
    }

    function updatePhysics() {
      const W = window.innerWidth, H = window.innerHeight;
      for (let i = 0; i < balls.length; i++) {
        for (let j = i + 1; j < balls.length; j++) {
          let a = balls[i], b = balls[j];
          if (rectsCollide(a, b)) {
            resolveCollision(a, b);
          }
        }
      }
      for (let ball of balls) {
        ball.x += ball.vx;
        ball.y += ball.vy;

        // Colisi√≥n con bordes
        if (ball.x < 0) { ball.x = 0; ball.vx *= -1; }
        if (ball.x > W - ball.w) { ball.x = W - ball.w; ball.vx *= -1; }
        if (ball.y < 0) { ball.y = 0; ball.vy *= -1; }
        if (ball.y > H - ball.h) { ball.y = H - ball.h; ball.vy *= -1; }

        ball.img.style.left = ball.x + "px";
        ball.img.style.top = ball.y + "px";
      }
      requestAnimationFrame(updatePhysics);
    }

    window.addEventListener("resize", () => {
      // Las im√°genes siguen rebotando y colisionando en el nuevo tama√±o
    });

    updatePhysics();
  });
  </script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="main.js"></script>
</body>
</html>
